<html>
  <body>
    <div id="container" style="font-size: 10px; font-family: Arial">
        <svg id="box" viewBox="0 0 100 10" xmlns="http://www.w3.org/2000/svg"></svg>
        <svg viewBox="0 0 100 10" xmlns="http://www.w3.org/2000/svg">
            <rect id="holder-rect" width="10px" height="10px" rx="2"></rect>
            <text id="holder-text" x="2" y="8.3" fill="white"></text>
        </svg>
    </div>
    <div id="stats"></div>
    <button onclick="next();">Next</button>
    <script>
        const length = 10;
        const partLength = length / 2;
        const box = document.getElementById("box");
        const showStats = document.getElementById("stats");

        // toC++
        const stats = {
            pos: null,
            moved: 0,
            pot: null,
            buff: []
        };
        function inversePosFrom(i, partLength) {
            if (i % 2 != 0) {
                return partLength + ((i - 1) / 2);
            }
            return i / 2;
        }
        //

        for (var i = 0; i < length; ++i) {
            stats.buff[i] = 1.0 * i;
        }

        function next() {
            if (stats.pos === null) {
                stats.pos = 1;
            }
            const nextPos = inversePosFrom(stats.pos, partLength);
            stats.pot = stats.buff[stats.pos];
            stats.buff[stats.pos] = stats.buff[nextPos];
            stats.pos = nextPos;

            render();
        }

        function render() {
            for (var i = 0; i < length; ++i) {
                const v = stats.buff[i];
                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("y", 0);
                rect.setAttribute("x", i * 10);
                rect.setAttribute("width", "10");
                rect.setAttribute("height", "10");
                rect.setAttribute("rx", "2");

                if (i === stats.pos) {
                    rect.setAttribute("fill", "lightgrey");
                } else {
                    const colour = v >= partLength ? [0, 0, 255] : [255, 0, 0];
                    colour[1] += (v % partLength) * (255 / partLength);
                    rect.setAttribute("fill", "rgb(" + colour.join(",") + ")");
                }

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("y", 8.3);
                text.setAttribute("x", 2 + (i * 10));
                text.setAttribute("fill", "white");
                text.innerHTML = v;

                box.appendChild(rect);
                box.appendChild(text);
            }
            if (stats.pot !== null) {
                document.getElementById("holder-text").innerHTML = stats.pot;
            }
            showStats.innerHTML = "";
            for (s in stats) {
                const stat = document.createElement("div");
                stat.innerHTML = s + ": " + stats[s];
                showStats.appendChild(stat);
            }
        };
        render();
    </script>
  </body>
</html>
