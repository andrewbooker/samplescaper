<html>
  <body>
    <div id="container" style="font-size: 10px; font-family: Arial">
        <svg id="box" viewBox="0 0 100 10" xmlns="http://www.w3.org/2000/svg"></svg>
        <svg viewBox="0 0 100 10" xmlns="http://www.w3.org/2000/svg">
            <rect id="holder-rect" width="10px" height="10px" rx="2"></rect>
            <text id="holder-text" x="2" y="8.3" fill="white"></text>
        </svg>
    </div>
    <div id="stats"></div>
    <button onclick="next();">Next</button>
    <script>
        const length = 10;
        const partLength = length / 2;
        const box = document.getElementById("box");
        const showStats = document.getElementById("stats");

        // toC++
        const stats = {
            pos: 1,
            moved: 0
        };
        function inversePosFrom(i, partLength) {
            if (i % 2 != 0) {
                return partLength + ((i - 1) / 2);
            }
            return i / 2;
        }
        //

        function annotateCell(rect, text, origIdx) {
            const colour = origIdx >= partLength ? [0, 0, 255] : [255, 0, 0];
            colour[1] += (origIdx % partLength) * (255 / partLength);
            rect.setAttribute("fill", "rgb(" + colour.join(",") + ")");

            text.innerHTML = origIdx;
        }

        function move(fromIdx, toIdx) {
            const r = box.children.item(toIdx * 2);
            const t = box.children.item(1 + (toIdx * 2));

            box.children.item(fromIdx * 2).setAttribute("fill", "lightgrey");
            annotateCell(r, t, fromIdx);
            stats.moved += 1;
        }

        function next() {
            annotateCell(document.getElementById("holder-rect"), document.getElementById("holder-text"), stats.pos);

            const nextPos = inversePosFrom(stats.pos, partLength);
            move(nextPos, stats.pos);
            stats.pos = nextPos;

            showStats.innerHTML = "";
            for (s in stats) {
                const stat = document.createElement("div");
                stat.innerHTML = s + ": " + stats[s];
                showStats.appendChild(stat);
            }
        }

        (function draw() {
            for (var i = 0; i < length; ++i) {
                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("y", 0);
                rect.setAttribute("x", i * 10);
                rect.setAttribute("width", "10");
                rect.setAttribute("height", "10");
                rect.setAttribute("rx", "2");

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("y", 8.3);
                text.setAttribute("x", 2 + (i * 10));
                text.setAttribute("fill", "white");

                annotateCell(rect, text, i);

                box.appendChild(rect);
                box.appendChild(text);
            }
        })();
    </script>
  </body>
</html>
